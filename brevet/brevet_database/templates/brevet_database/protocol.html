{% extends "base.html" %}

{% block title %}
Протокол бревета {{ event.route.distance }} км от {{ event.get_date }} г. | 
{% endblock %}

{% block content %}
    <h3 class="text-center my-5">
        Протокол бревета {{ event.route.distance }} км от {{ event.get_date }} г.
    </h3>

    <h2 class="text-center my-4">
    {% if event.name %}
        {{ event.name }}
    {% endif %}
    </h2>

    {% if user.is_superuser %}
        {% if not event.is_homologated %}
            <div class="alert alert-primary" role="alert">
                <strong>Загрузка результатов омологации</strong>
                <form class = "my-2" method = "post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form }}
                    <input type="submit" value="OK">
                </form>
                {% if upload_exception %}
                    <p class="my-1">Ошибка при загрузке: {{ upload_exception }}</p>
                {% endif %}
                {% if upload_success %}
                <p class="my-1">Протокол успешно загружен.</p>
                {% endif %}
            </div>
        {% endif %}
    {% endif %}

    <p class="my-1">
        Старт состоялся <a href="{{ event.get_absolute_url }}"> {{ event.get_date }} г. в {{ event.get_time }}</a>.
    </p>
    {% if event.route.name %}
    <p class="my-1">
        Маршрут: <a href="{{ event.route.get_absolute_url }}"> "{{ event.route.name }}" </a>
    </p>
    {% endif %}
    {% if event.club %}
    <p class="my-1">
        Клуб-организатор: {{ event.club }}
    </p>
    {% endif %}
    {% if results %}
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Омологация</th>
                    <th>Рандоннёр</th>
                    <th>Время</th>
                    <th>Медаль</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                    <tr>
                        <td>{{ result.homologation }}</td>
                        <td>
                            <a href="{{ result.randonneur.get_absolute_url }}">
                                {{ result.randonneur }}
                            </a>
                        </td>
                        <td>{{ result.get_time }}</td>
                        <td>{% if result.medal %} М {% endif %}</td>
                    </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                {% if event.responsible %}
                    <tr>
                        <td colspan = "2" class="text-center">Ответственный организатор</td>
                        <td colspan = "2">{{ event.responsible }}</td>
                    </tr>
                {% endif %}
            </tfoot>
        </table>
        {% load static %}
        <div class="d-flex justify-content-end">
            <img src="{% static 'img/stamp.png' %}"/>
        </div>
    {% else %}
        <p>Результаты отсутствуют.</p>
    {% endif %}

{% endblock %}